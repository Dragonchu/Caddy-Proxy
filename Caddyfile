{
    admin off
    auto_https off
}

:{$PORT:8080} {
    # 健康检查（可选，方便 Railway 监控）
    handle /health {
        respond "OK" 200
    }

    # 1. Service A：仅匹配根路径 /
    handle / {
        reverse_proxy {$LANDING_TARGET} {
            header_up Host {upstream_hostport}
            header_up X-Real-IP {remote_host}
        }
    }

    # 2. Service B：匹配其他所有路径 (包含 WebSocket)
    handle {
        reverse_proxy {$APP_TARGET} {
            header_up Host {upstream_hostport}
            header_up X-Real-IP {remote_host}
            # Caddy 会自动识别并支持 WebSocket，无需额外配置
        }
    }

    # 全局压缩优化
    encode gzip
}
